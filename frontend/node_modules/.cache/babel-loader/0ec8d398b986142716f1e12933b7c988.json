{"ast":null,"code":"var _jsxFileName = \"/Users/vsevolodmarkov/Documents/dev/react-mesto-api-full/frontend/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupEditProfile from \"./PopupEditProfile\";\nimport PopupAvatarEdit from \"./PopupAvatarEdit\";\nimport PopupSubmitDelete from \"./PopupSubmitDelete\";\nimport ImagePopup from \"./ImagePopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport { api } from \"../utils/api\";\nimport { auth } from \"../utils/auth\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = React.useState(false);\n  const [isImagePopupOpen, setImagePopupOpen] = React.useState(false);\n  const [isSubmitDeletePopupOpen, setSubmitDeletePopupOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState(null);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [authUserEmail, setAuthUserEmain] = React.useState(\"\");\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const history = useHistory();\n  React.useEffect(() => {\n    Promise.all([api.getUserInfo(), api.getInitialCards()]).then(_ref => {\n      let [user, cards] = _ref;\n      setCurrentUser(user);\n      setCards(cards);\n    }).catch(err => console.log(err));\n  }, []);\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    api.changeLikeCardStatus(card._id, !isLiked).then(newCard => {\n      const newCards = cards.map(c => c._id === card._id ? newCard : c);\n      setCards(newCards);\n    }).catch(err => console.log(err));\n  }\n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id).then(() => {\n      const newCards = cards.filter(c => c._id !== card._id);\n      setCards(newCards);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setImagePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setAddPlacePopupOpen(true);\n  }\n\n  function handleSubmitDeleteClick(card) {\n    setSelectedCard(card);\n    setSubmitDeletePopupOpen(true);\n  }\n\n  function handleUpdateUser(data) {\n    api.setUserInfo(data.name, data.about).then(data => {\n      setCurrentUser(data);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleUpdateAvatar(data) {\n    api.updateAvatar(data.avatar).then(data => {\n      setCurrentUser(data);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleAddPlaceSubmit(card) {\n    api.addNewCard(card.name, card.link).then(card => {\n      setCards([card, ...cards]);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function closeAllPopups() {\n    setEditAvatarPopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setEditProfilePopupOpen(false);\n    setImagePopupOpen(false);\n    setSubmitDeletePopupOpen(false);\n    setIsInfoTooltipOpen(false);\n    setSelectedCard(null);\n  }\n\n  React.useEffect(() => {\n    const closeByEscape = e => {\n      if (e.key === \"Escape\") {\n        closeAllPopups();\n      }\n    };\n\n    document.addEventListener(\"keydown\", closeByEscape);\n    return () => document.removeEventListener(\"keydown\", closeByEscape);\n  }, []);\n\n  function handleLoginSubmit(password, userName) {\n    auth.authorize(password, userName).then(data => {\n      console.log(data);\n      localStorage.setItem(\"token\", data.token);\n      localStorage.setItem(\"email\", userName);\n      handleLoginSuccess(userName);\n      history.push(\"/\");\n    }).catch(err => {\n      console.log(err);\n      handleLoginNotSuccess();\n    });\n  }\n\n  function handleLoginSuccess(email) {\n    setLoggedIn(true);\n    setAuthUserEmain(email);\n  }\n\n  function handleLoginNotSuccess() {\n    setLoggedIn(true);\n    setIsInfoTooltipOpen(true);\n    setLoggedIn(false);\n  }\n\n  function handleRegisterSubmit(password, userName) {\n    auth.register(password, userName).then(data => {\n      console.log(data);\n      handleRegisterSuccess();\n      history.push(\"/sign-in\");\n    }).catch(err => {\n      console.log(err);\n      handleRegisterNotSuccess();\n    });\n  }\n\n  function handleRegisterSuccess() {\n    setIsInfoTooltipOpen(true);\n    setLoggedIn(true);\n  }\n\n  function handleRegisterNotSuccess() {\n    setIsInfoTooltipOpen(true);\n    setLoggedIn(false);\n  }\n\n  function handleLogout() {\n    setLoggedIn(false);\n    setAuthUserEmain(\"\");\n  }\n\n  React.useEffect(() => {\n    if (localStorage.getItem(\"token\")) {\n      const token = localStorage.getItem(\"token\");\n      auth.checkToken(token).then(data => {\n        handleLoginSuccess(data.data.email);\n        console.log(loggedIn, data);\n        history.push(\"/\");\n      }).catch(err => console.log(err));\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      email: authUserEmail,\n      loggedIn: loggedIn,\n      loggedOut: handleLogout\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        path: \"/sign-up\",\n        children: /*#__PURE__*/_jsxDEV(Register, {\n          history: history,\n          handleRegisterSubmit: handleRegisterSubmit\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/sign-in\",\n        children: /*#__PURE__*/_jsxDEV(Login, {\n          loggedIn: setLoggedIn,\n          handleLoginSubmit: handleLoginSubmit,\n          history: history\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n        exact: true,\n        path: \"/\",\n        component: Main,\n        loggedIn: loggedIn,\n        cards: cards,\n        onEditProfile: handleEditProfileClick,\n        onEditAvatar: handleEditAvatarClick,\n        onAddPlace: handleAddPlaceClick,\n        onCardClick: handleCardClick,\n        onCardLike: handleCardLike,\n        onCardDelete: handleSubmitDeleteClick\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PopupEditProfile, {\n      isOpen: isEditProfilePopupOpen,\n      onClose: closeAllPopups,\n      onUpdateUser: handleUpdateUser\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PopupAvatarEdit, {\n      isOpen: isEditAvatarPopupOpen,\n      onClose: closeAllPopups,\n      onUpdateAvatar: handleUpdateAvatar\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PopupSubmitDelete, {\n      isOpen: isSubmitDeletePopupOpen,\n      card: selectedCard,\n      onClose: closeAllPopups,\n      onSubmitDelete: handleCardDelete\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n      isOpen: isImagePopupOpen,\n      card: selectedCard,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n      isOpen: isAddPlacePopupOpen,\n      onClose: closeAllPopups,\n      onAddPlace: handleAddPlaceSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n      isSuccess: loggedIn,\n      isOpen: isInfoTooltipOpen,\n      onClose: closeAllPopups\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 214,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"yIo4glOilAtJx//WmdGd0SIk4zw=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/vsevolodmarkov/Documents/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","Route","Switch","useHistory","Header","Main","Footer","PopupEditProfile","PopupAvatarEdit","PopupSubmitDelete","ImagePopup","AddPlacePopup","Login","Register","api","auth","CurrentUserContext","ProtectedRoute","InfoTooltip","App","isEditProfilePopupOpen","setEditProfilePopupOpen","useState","isAddPlacePopupOpen","setAddPlacePopupOpen","isEditAvatarPopupOpen","setEditAvatarPopupOpen","isImagePopupOpen","setImagePopupOpen","isSubmitDeletePopupOpen","setSubmitDeletePopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","authUserEmail","setAuthUserEmain","loggedIn","setLoggedIn","history","useEffect","Promise","all","getUserInfo","getInitialCards","then","user","catch","err","console","log","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","newCards","map","c","handleCardDelete","deleteCard","filter","closeAllPopups","handleCardClick","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleSubmitDeleteClick","handleUpdateUser","data","setUserInfo","name","about","handleUpdateAvatar","updateAvatar","avatar","handleAddPlaceSubmit","addNewCard","link","closeByEscape","e","key","document","addEventListener","removeEventListener","handleLoginSubmit","password","userName","authorize","localStorage","setItem","token","handleLoginSuccess","push","handleLoginNotSuccess","email","handleRegisterSubmit","register","handleRegisterSuccess","handleRegisterNotSuccess","handleLogout","getItem","checkToken"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\n\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupEditProfile from \"./PopupEditProfile\";\nimport PopupAvatarEdit from \"./PopupAvatarEdit\";\nimport PopupSubmitDelete from \"./PopupSubmitDelete\";\nimport ImagePopup from \"./ImagePopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\n\nimport { api } from \"../utils/api\";\nimport { auth } from \"../utils/auth\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from \"./InfoTooltip\";\n\nfunction App() {\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] =\n    React.useState(false);\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = React.useState(false);\n  const [isImagePopupOpen, setImagePopupOpen] = React.useState(false);\n  const [isSubmitDeletePopupOpen, setSubmitDeletePopupOpen] =\n    React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n\n  const [selectedCard, setSelectedCard] = React.useState(null);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [authUserEmail, setAuthUserEmain] = React.useState(\"\");\n\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const history = useHistory();\n\n  React.useEffect(() => {\n    Promise.all([api.getUserInfo(), api.getInitialCards()])\n      .then(([user, cards]) => {\n        setCurrentUser(user);\n        setCards(cards);\n      })\n      .catch((err) => console.log(err));\n  }, []);\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n\n    api\n      .changeLikeCardStatus(card._id, !isLiked)\n      .then((newCard) => {\n        const newCards = cards.map((c) => (c._id === card._id ? newCard : c));\n        setCards(newCards);\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleCardDelete(card) {\n    api\n      .deleteCard(card._id)\n      .then(() => {\n        const newCards = cards.filter((c) => c._id !== card._id);\n        setCards(newCards);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n    setImagePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setAddPlacePopupOpen(true);\n  }\n\n  function handleSubmitDeleteClick(card) {\n    setSelectedCard(card);\n    setSubmitDeletePopupOpen(true);\n  }\n\n  function handleUpdateUser(data) {\n    api\n      .setUserInfo(data.name, data.about)\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleUpdateAvatar(data) {\n    api\n      .updateAvatar(data.avatar)\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function handleAddPlaceSubmit(card) {\n    api\n      .addNewCard(card.name, card.link)\n      .then((card) => {\n        setCards([card, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(err));\n  }\n\n  function closeAllPopups() {\n    setEditAvatarPopupOpen(false);\n    setAddPlacePopupOpen(false);\n    setEditProfilePopupOpen(false);\n    setImagePopupOpen(false);\n    setSubmitDeletePopupOpen(false);\n    setIsInfoTooltipOpen(false);\n    setSelectedCard(null);\n  }\n\n  React.useEffect(() => {\n    const closeByEscape = (e) => {\n      if (e.key === \"Escape\") {\n        closeAllPopups();\n      }\n    };\n\n    document.addEventListener(\"keydown\", closeByEscape);\n\n    return () => document.removeEventListener(\"keydown\", closeByEscape);\n  }, []);\n\n  function handleLoginSubmit(password, userName) {\n    auth\n      .authorize(password, userName)\n      .then((data) => {\n        console.log(data);\n        localStorage.setItem(\"token\", data.token);\n        localStorage.setItem(\"email\", userName);\n        handleLoginSuccess(userName);\n        history.push(\"/\");\n      })\n      .catch((err) => {\n        console.log(err);\n        handleLoginNotSuccess();\n      });\n  }\n\n  function handleLoginSuccess(email) {\n    setLoggedIn(true);\n    setAuthUserEmain(email);\n  }\n\n  function handleLoginNotSuccess() {\n    setLoggedIn(true);\n    setIsInfoTooltipOpen(true);\n    setLoggedIn(false);\n  }\n\n  function handleRegisterSubmit(password, userName) {\n    auth.register(password, userName).then((data) => {\n      console.log(data);\n      handleRegisterSuccess();\n      history.push(\"/sign-in\");\n    })\n    .catch((err) => {\n      console.log(err);\n      handleRegisterNotSuccess();\n    })\n  }\n\n  function handleRegisterSuccess() {\n    setIsInfoTooltipOpen(true);\n    setLoggedIn(true);\n  }\n\n  function handleRegisterNotSuccess() {\n    setIsInfoTooltipOpen(true);\n    setLoggedIn(false);\n  }\n\n  function handleLogout() {\n    setLoggedIn(false);\n    setAuthUserEmain(\"\");\n  }\n\n  React.useEffect(() => {\n    if (localStorage.getItem(\"token\")) {\n      const token = localStorage.getItem(\"token\");\n      auth\n        .checkToken(token)\n        .then((data) => {\n          handleLoginSuccess(data.data.email);\n          console.log(loggedIn, data);\n          history.push(\"/\");\n        })\n        .catch((err) => console.log(err));\n    }\n  }, []);\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <Header\n        email={authUserEmail}\n        loggedIn={loggedIn}\n        loggedOut={handleLogout}\n      />\n      <Switch>\n        <Route path=\"/sign-up\">\n          <Register \n            history={history} \n            handleRegisterSubmit={handleRegisterSubmit} \n          />\n        </Route>\n        <Route path=\"/sign-in\">\n          <Login\n            loggedIn={setLoggedIn}\n            handleLoginSubmit={handleLoginSubmit}\n            history={history}\n          />\n        </Route>\n        <ProtectedRoute\n          exact\n          path=\"/\"\n          component={Main}\n          loggedIn={loggedIn}\n          cards={cards}\n          onEditProfile={handleEditProfileClick}\n          onEditAvatar={handleEditAvatarClick}\n          onAddPlace={handleAddPlaceClick}\n          onCardClick={handleCardClick}\n          onCardLike={handleCardLike}\n          onCardDelete={handleSubmitDeleteClick}\n        />\n      </Switch>\n\n      <Footer />\n\n      <PopupEditProfile\n        isOpen={isEditProfilePopupOpen}\n        onClose={closeAllPopups}\n        onUpdateUser={handleUpdateUser}\n      />\n      <PopupAvatarEdit\n        isOpen={isEditAvatarPopupOpen}\n        onClose={closeAllPopups}\n        onUpdateAvatar={handleUpdateAvatar}\n      />\n      <PopupSubmitDelete\n        isOpen={isSubmitDeletePopupOpen}\n        card={selectedCard}\n        onClose={closeAllPopups}\n        onSubmitDelete={handleCardDelete}\n      />\n      <ImagePopup\n        isOpen={isImagePopupOpen}\n        card={selectedCard}\n        onClose={closeAllPopups}\n      />\n      <AddPlacePopup\n        isOpen={isAddPlacePopupOpen}\n        onClose={closeAllPopups}\n        onAddPlace={handleAddPlaceSubmit}\n      />\n      <InfoTooltip\n        isSuccess={loggedIn}\n        isOpen={isInfoTooltipOpen}\n        onClose={closeAllPopups}\n      />\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}